<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RelicBound: Final Option</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body style="background-image: url('images/cityscape-skyscraper-night-urban-skyline-architecture-dusk-outdoors-sunset-generated-by-artificial-intelligence.jpg')">
    <audio controls autoplay muted>
        <source src="audio/ending.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
      </audio>
    <div id="fade-overlay"></div>
    <header>
        <h1>Mission: Defeat the Boss</h1>
     </header>
    <img src="images/crown.png" class="img-resize"/>
    <style>
        .img-resize {
            transform: scale(1.5);
            margin: 50px;
        }
    </style>
    <p>"You have brought victory to your name!"</p>
    <p>Congratulations for making your journey worthwhile,</p>
    <p>You have been crowned and gained the title 'Saint of Relics'.</p>
    <p>Now, you and your freinds can live in peace with the world free from the final boss, The darkload, mcdowell.</p>
    <p>Your legacy will live past you...</p>
    <button style="width: 50%;" type="button" onclick="location.href='summary.html'">NEXT</button>

    <!-- ADD FROM HERE -->
    <div id="results"></div>

<script>



let userId = sessionStorage.getItem("userId");
        let gameuserId = sessionStorage.getItem("gameuserId");
        let gameId = sessionStorage.getItem("gameId");

// let userId = 81;
//         let gameuserId = 3;
//         let gameId = 34;

    // Function to update defeatedBoss field using game ID from session storage

    async function updateDefeatedBossStatus() {
    let hostname = 'localhost';
    let username = 'rcareysmall01';
    let password = 'q1YsjQG0CHDhBXQ5';
    let database = 'CSC1034_CW_47';
    let query = `UPDATE gameTable SET defeatedBoss=1 WHERE gameId = ${gameId}`;

    let params = new URLSearchParams();
    params.append('hostname', hostname);
    params.append('username', username);
    params.append('password', password);
    params.append('database', database);
    params.append('query', query);

    let url = 'https://rcareysmall01.webhosting1.eeecs.qub.ac.uk/dbConnector.php';

    try {
        let response = await fetch(url, {
            method: 'POST',
            body: params
        });

        if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
        }

        let rawResponse = await response.text();
        console.log("Raw Response:", rawResponse);

        let result;
        try {
            result = JSON.parse(rawResponse);
        } catch (error) {
            console.error("Error parsing JSON:", error);
            document.getElementById('results').innerHTML = `<p style="color:yellow;">Error: ${error.message}</p>`;
            return;
        }

        let resultsDiv = document.getElementById("results");
        console.log("ResultsDiv:", resultsDiv); // If null, the element is missing


if (resultsDiv) {
    console.log( "Boss defeat status updated successfully!");
} else {
    console.error("Error: 'results' element not found in DOM.");
}


        if (result.error) {
            console.log(result.error.toString());
            
        } else if (result.success) {
            console.log("Update successful!");
            
        } else {
            console.log("Update failed!");
            
        }
    } catch (error) {
        console.error("Error during fetch:", error);
        
    }
}

window.onload = function() {
    updateDefeatedBossStatus();
};

window.addEventListener("DOMContentLoaded", function () {
    updateDefeatedBossStatus();
});
</script>
    <!-- FINISH ADD HERE -->
</body>
</html>
