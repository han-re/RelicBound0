<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>

body{ 
            position: relative;
            width: 100%;
            height: 100%;
            background-image:url('cityscape-skyscraper-night-urban-skyline-architecture-dusk-outdoors-sunset-generated-by-artificial-intelligence.jpg');
            background-size: cover;
            background-position: center;
            justify-content: center;
            align-items: center;
            display: flex;
        }

            .menuContainer {
            height: 100%;
            width: calc(var(--btn-size) * 10);
            background: rgb(0, 0, 0,0);
            border: 4px solid #8b000000;
            padding: 20px;
            text-align: center;
            color: white;
            display: block;
        }
            .settingsButton {
            width: 7.5vw;   
            height: 3vw; 
            text-align: center;
            padding: 0.2vw;
            background-image: url('https://i.ibb.co/rb2TWXL/bgbtn.png');
	        border: 2px solid #000;
            cursor: pointer;
            font-size: 1em;
            color: #ffffff;
            transition: background-color 0.3s; 
            position: relative; 
        }

        .settingsButton:hover {
            text-shadow: 2px 2px #202013CC;
            color: #FFFFA0;
            border: 2px solid #ffffff;
            
            }

            #settingsScreen {
            display: none;
        }
       
    
            #settingsScreen {
            display: none;
        }

        .settingsOption {
            width: flex;
            display: flex;
            font-size: 1.5em;
            color: #ffffff;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background-image: url('https://i.ibb.co/rb2TWXL/bgbtn.png');
	        border: 2px solid #000;
            transition: background-color 0.3s;
        }
            
        .settingsOption:hover {
        text-shadow: 2px 2px #202013CC;
		color: #FFFFA0;
        border: 2px solid #ffffff;
        
        }
    </style>
    
    <title>Welcome</title>
    <link rel="stylesheet" href="style0.css">
</head>

<body>

    <audio id="backgroundMusic" loop>
        <source src="fantasy.mp3" type="audio/mpeg">
        
    </audio> 
<!--  -------------------------------------------------------------------------->
    <div class = "menuButton" id="mainMenu" style = "display: block;">
    <div id="fade-overlay"></div>

    <header class="title">
        <h1>RelicBound</h1>
    </header>
    
    <main>
        <section class="text">
            <h2>Welcome to RelicBound!</h2>
            <div class="textBox" id="welcome"></div>
            
            <br>
            <h2>Game Rules & World</h2>
            <div class="textBox" id="rules"></div>

            <br>
            <h2>Powers</h2>
            <div class="textBox" id="powers"></div>
        </section>
        
        <div class="start">
            <button class="startBtn" onclick="window.location.href='powers.html'">Start Adventure !</button>
        </div>
        <div id="settingsBtn" class="settingsButton"> Settings</div>   
    </main>
    </div>

    <div class="menuContainer" id="settingsScreen" style = "width: 45vw;  height: 45vw;">
        <h1 class="title" style="margin-bottom: 8vw;" >SETTINGS</h1 >

        

    <div class="settingsOption">
        <span>Music</span>
        <label class="toggleSwitch">
            <input type="checkbox" id="musicToggle">
            <span class="slider"></span>
        </label>
    </div>

    <div class="settingsOption" id="resumeBtn">
        <span>Resume Game</span>
    </div>

    <div class="settingsOption" id="backToMainMenu">
        <span>Back To Main Menu<span>  
    </div>

</div>


    

    
    <script>
        // Improved text content that matches the sections
        const introText = "The fate of the universe rests in your hands. You have been tasked to destroy the evil overlord known as Blooblah. Every decision you make shapes the world and determines your destiny.";
        
        const rulesText = "As mentioned above, your choices shape the world. Each scenario presents multiple choices. You will have to choose between these options.\n\nChoose WRONG and you will face consequences.\n\nExplore, battle, and uncover the mysteries of time.";
        
        const powersText = "Before your journey begins, you will unlock extraordinary abilities. These powers will shape your path, alter fate, and influence critical decisions. Choose wisely, as each ability carries strengths and weaknesses that will define your destiny.";
        
        // Improved typewriter function with error handling
        function typeWriter(elementId, text, speed) {
            let i = 0;
            const element = document.getElementById(elementId);
            
            if (!element) {
                console.error(`Element with ID ${elementId} not found`);
                return;
            }
            
            element.innerHTML = ''; // Clear any existing content
            
            function typing() {
                if (i < text.length) {
                    element.innerHTML += text.charAt(i);
                    i++;
                    setTimeout(typing, speed);
                }
            }
            
            typing();
        }
        
        // Initialize the page when it loads
        window.onload = function() {
            // Start typing animations with appropriate delays
            typeWriter("welcome", introText, 20);
            setTimeout(() => typeWriter("rules", rulesText,20), introText.length * 20 + 500);
            setTimeout(() => typeWriter("powers", powersText, 20), (introText.length + rulesText.length) * 20 + 1000);
            
            // Add event listeners for choice buttons
            document.querySelectorAll('.choiceBtn').forEach(button => {
                button.addEventListener('click', function() {
                    alert('You chose: ' + this.textContent);
                    // Here you would add the game logic for handling choices
                });
            });
        };
        

        let dbConfig = new URLSearchParams({
        hostname: 'localhost',
        username: 'sdas06',
        password: '6g5X6MLgPjfWMSBS',
        database: 'CSC1034_CW_47',
        query: ''
        });

        //this var will be use to store the default screens id before the settings screen pops up 
        //you willl have to change mainMenu according to what the id of the main block
        const mainMenu = document.getElementById('mainMenu');
        const settingsScreen = document.getElementById('settingsScreen');
        const backgroundMusic = document.getElementById('backgroundMusic');
        const settingsBtn = document.getElementById('settingsBtn');

        // to show settings
        function showSettings() {
            mainMenu.style.display = 'none';
            settingsScreen.style.display = 'block';
        }
        
        function resumeGame() {
            mainMenu.style.display = 'block';
            settingsScreen.style.display = 'none';
        }

        settingsBtn.addEventListener('click', showSettings);


        //settings page functionality
        const resumeBtn = document.getElementById('resumeBtn');
        const backtoMainMenu = document.getElementById('backToMainMenu');
        
       
       async function toMainMenu(){

            const currentUrl = window.location.href;

            console.log("Before navigation - UserID:", sessionStorage.getItem("userId"));
            console.log("Before navigation - GameUserID:", sessionStorage.getItem("gameuserID"));
            // Save the current URL to the lastLevel column in gameTable
            console.log("Current URL:", currentUrl);
             await saveLastLevel(currentUrl);
    
            // Then redirect to the main menu
            window.location.href = 'StartPageTest.html';
        }

    
        resumeBtn.addEventListener('click', resumeGame);
        backtoMainMenu.addEventListener('click',toMainMenu);

        window.addEventListener('load', function() {
        backgroundMusic.play().catch(error => {
        console.log('Auto-play was prevented. User interaction needed to start audio.');
        // Many browsers require user interaction before playing audio
            });
        });

        // Music toggle functionality
        const musicToggle = document.getElementById('musicToggle');
        musicToggle.checked = true; // Set checked by default

        musicToggle.addEventListener('change', function() {
        if (this.checked) {
        backgroundMusic.play();
         } 

        else {
        backgroundMusic.pause();
        }
    });

// Additional function to ensure music can start after user interaction
        document.addEventListener('click', function() {
        if (musicToggle.checked && backgroundMusic.paused) {
        backgroundMusic.play();
        }
        }, {once: true});


        
async function toMainMenu() {
    // Get the current page URL

    const currentUrl = window.location.href;

    console.log(currentUrl);
    // Save the current URL to the lastLevel column in gameTable
    await saveLastLevel(currentUrl);
    
    // Then redirect to the main menu
    window.location.href = 'StartPageTest.html';
}
////////////////////////////////////////////////////////////////////////////

    async function saveLastLevel(pageUrl) {
    // Get the current gameID from session storage

    const gameId = localStorage.getItem("gameID");
    console.log(gameId);
    
    if (!gameId) {
        console.error("Cannot save last level: No active game");
        return;
    }
    
    // Create query to update the lastLevel in gameTable
        const query = `UPDATE gameTable SET lastLevel = '${pageUrl}' WHERE gameID = ${gameId}`;
        dbConfig.set('query', query);
    
        try {
        const response = await fetch('https://sdas06.webhosting1.eeecs.qub.ac.uk/dbConnector.php', {
            method: "POST",
            body: dbConfig
        });
        
        const result = await response.json();
        
        if (result.success) {
            console.log("Last level saved successfully:", pageUrl);

        } else {
            console.error("Failed to save last level:", result.message);
        }
        } catch (error) {
        console.error("Error saving last level:", error);
        }
    }
    </script>
</body>
</html>

